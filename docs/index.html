<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Divided Congress And Coverage?</title>
        <meta name="description" content="442 Final Project">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <style>
		*{
			box-sizing: border-box;
		}

		html,
		body {
			margin: 0;
			padding: 0;
			font-family: 'Droid Serif', serif;
		}

		body {
			min-height: 1280px;
			font-weight: 300;
			color: #2a2a2a;
		}

		p,
		h1,
		h2,
		h3,
		h4,
		a {
			margin: 0;
			font-weight: 300;
		}

		a
		{
            color: black;
            font-style: italic;
			text-decoration: none;
			border-bottom: 1px solid currentColor;
		}

		#intro {
			max-width: 40rem;
			margin: auto;
			text-align: center;
            line-height: 1.8em;
            padding-bottom: 2rem;
		}

		.intro__overline {
			font-size: 1.4rem;
		}

		.intro__hed {
			font-size: 64px;
            line-height: 1em;
			margin: auto;
			text-transform: uppercase;
			font-weight: 900;
			letter-spacing: 0.05em;
		}

		.intro__dek {
			font-size: 1.4rem;
		}

        #c_smart {
            font-size: 12px;
            font-style: italic;
            padding-bottom: 2.5rem;
        }

        #f_char {
            float: left;
            font-size: 350%;
            font-weight: 600;
            line-height: 60px;
            padding-top: 4px;
        }

        .word_cloud {
            display: inline-block;
        }

            /* demo */

        .d_back_black {
            background-color: #30303d;
            color: #efefef;
            line-height: 1.7;
            font-size: 15px;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            padding-top: 3rem;
        }

        .d_back_white {
            padding-top: 3rem;
            background-color: #fafafa;
            color: #181619;
        }

        .nn_mouse_over_current {
            fill: brown;
        }

		#outro {
			height: 640px;
		}

		/* scrollama */

		#scroll, #scroll_1 {
			position: relative;
		}

        .scroll__section {
            padding: 20px 20px;
            position: relative;
        }

		.scroll__graphic {
			position: absolute;
			top: 0;
			right: 2rem;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
		}

		.scroll__graphic.is-fixed {
			position: fixed;
		}

		.scroll__graphic.is-bottom {
			bottom: 0;
			top: auto;
		}

		.scroll__graphic p {
			text-align: center;
			padding: 1rem;
			position: absolute;
			top: 50%;
			left: 50%;
			-moz-transform: translate(-50%, -50%);
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			font-size: 8rem;
			font-weight: 900;
			color: #666;
		}

		.scroll__text {
			position: relative;
			padding: 0 1rem;
			max-width: 60rem;
            width: 33%;
        }

        .channel {
            font-weight: bold;
        }

		.step {
			margin: 0 auto 0 auto;
			/* border-bottom: none; */
		}

		.step:last-child {
			border-bottom: 1px solid #333;
		}

		.step.is-active {
			background-color: #ddd;
		}

		.step p {
			text-align: center;
			padding: 1rem;
            font-size: 1.4rem;
            line-height: 1.3em;
        }

        .topic {
            font-weight: bold;
        }

        .axis .domain { display: none; }
        .scroll__graphic .axis .tick {display: none;}

        text.label {
            text-transform: uppercase;
            font-family: monospace;
            font-weight: 700;
            font-size: 24px;
            letter-spacing: 0.1;
        }
        path.arrow, text.label {
            fill: #30303d;
            cursor: pointer;
        }

        .point {
            fill: #30303d;
            fill-opacity: 0.8;
            stroke-width: 1;
        }

        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 50%;
            padding-bottom: 2.5rem;
        }

        .toolTip {
            position: absolute;
            display: none;
            min-width: 80px;
            height: auto;
            background: none repeat scroll 0 0 #ffffff;
            border: 1px solid black;
            padding: 14px;
            text-align: center;
            text-transform: uppercase;
        }

        .graphic__hed{
            text-align:center;
            color:#333;
        }

        .chart{
            max-width:40rem;
            margin:0 auto;
            text-align:center;
        }

        .slider{
            max-width:20rem;
            margin:1rem auto;
            position:relative;
            padding-top:16.5px;
        }

        .slider input{
            display:block;
            width:100%;
        }

        .slider:before{
            content:'100% <- Screentime';
            text-transform:uppercase;
            font-size:11px;
            letter-spacing:.05em;
            color:#888;
            display:inline-block;
            position:absolute;
            top:0;
            left:0;
        }

        .slider:after{
            content:'Mentions -> 100%';
            text-transform:uppercase;
            font-size:11px;
            letter-spacing:.05em;
            color:#888;
            display:inline-block;
            position:absolute;
            top:0;
            right:0;
        }

        .g-axis line,.g-axis path{
            stroke:#ccc;
        }

        .g-axis text{
            fill:#888;
        }

        .g-axis .axis__label{
            text-transform:uppercase;
            font-size:11px;
            letter-spacing:.05em;
            fill:#888;
        }

        .item{
            fill-opacity:.75;
        }

        .pivot_label, .chart_label {
            text-align: center;
            font-weight:  900;
            font-size: 150%;
            color: #888;
        }

        #pivot_scatter, #noun_to_verb {
            margin-top: 50px;
            margin-bottom: 50px;
            align-content: center;
            text-align: center;
        }

        .graphic--2, .graphic--3 {
            float: left;
        }
        .graphic--1 {
            padding-top: 300px;
            margin: auto;
        }

        #pivot_intro, #nv_title {
            font-size: 32px;
            line-height: 1em;
			margin: auto;
            padding-top: 2.5rem;
            padding-bottom: 2.5rem;
			text-transform: uppercase;
			font-weight: 700;
            color:#888;
        }

        #pivot_info, #nv_info {
            font-size: 1.4rem;
            color:#888;
            text-align: center;
            line-height: 1.3em;
            padding-bottom: 100px;
            padding-left: 300px;
            padding-right: 300px;
        }

        #pivot_container {
            padding-left: 5%;
        }

        #nn_title {
            font-size: 32px;
            line-height: 1em;
			margin: auto;
            padding-top: 2.5rem;
            padding-bottom: 2.5rem;
            text-transform: uppercase;
            font-weight: 700;
        }

        #nn_info {
            font-size: 1.4rem;
            padding-bottom: 100px;
            padding-left: 200px;
            padding-right: 200px;
            line-height: 1.3em;
        }

        #assoc {
            align-content: center;
            text-align: center;
        }

        #circle circle {
            fill: none;
            pointer-events: all;
        }

        button {
            background-color: #555555;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin: 2px 1px;
            cursor: pointer;
        }
        button:hover {
            background-color: #fafafa;
            color: #555555;
        }

        .btns {
            margin-left: 5px;
            margin-bottom: 10px;
        }

        .step .nn_description {
            font-size: 1.25rem;
            padding-left: 50px;
            padding-right: 50px;
        }

        blockquote {
            background: #f9f9f9;
            border-left: 10px solid #ccc;
            margin: 1.5em 10px;
            padding: 0.5em 10px;
            font-size: 1.4rem;
            line-height: 1.5em;
            quotes: "\201C""\201D""\2018""\2019";
        }

        blockquote:before {
            color: #ccc;
            content: open-quote;
            font-size: 4em;
            line-height: 0.1em;
            margin-right: 0.25em;
            vertical-align: -0.4em;
        }
        blockquote p {
            display: inline;
        }

        #quote {
            padding-left: 200px;
            padding-right: 200px;
            padding-bottom: 150px;
        }

        .node rect {
            cursor: move;
            fill-opacity: .9;
            shape-rendering: crispEdges;
        }

        .node text {
            pointer-events: all;
            text-shadow: 0 1px 0 #fff;
        }

        .link {
            fill: none;
            stroke: #000;
            stroke-opacity: .2;
        }

        .link:hover {
            stroke-opacity: .5;
        }

        circle.node-dot {
            fill: DarkSlateGray;
            stroke: SlateGray;
            stroke-width: 1px;
        }

        line.link {
            fill: none;
            stroke: SlateGray;
            stroke-width: 1.5px;
        }

        marker#defaultMarker {
            fill: SlateGray;
        }

        line.link.defaultMarker {
            stroke: SlateGray;
        }

        .node {
            fill-opacity: 0.6;
        }

        text {
            pointer-events: all;
        }

        text.shadow {
            stroke: #fff;
            stroke-width: 3px;
            stroke-opacity: .8;
        }

        </style>
    </head>
    <body>
        <div class = "d_back_white">
            <section id = "intro">
                <h1 class="intro__hed">Divided Congress & Coverage?</h1>
                <p class = "intro_dek" id = "c_smart">Inspired by Charlie Smart's <a href = "https://pudding.cool/2018/01/chyrons/" target = "_blank">visualization</a> on The Pudding</p>
                <img src="intro_icon.png" width="200" height="350" class = "center">
                <p class="intro__dek">
                    <span id = "f_char">T</span>oday, Americans are more ideologically divided than anytime in the past. As a result, the American consumers increasingly prefer media
                    that confirms to their own political and social preferences, which inturn seeps bias into the content itself. It becomes a vicious feedback loop.
                    Research shows that this bias in content operates via two mechanisms:
                    <a href = "https://www8.gsb.columbia.edu/media/sites/media/files/JustinRaoMediaBias.pdf" target = "_blank"><span style = "font-weight: bold">ISSUE <span style = "color: brown">FILTERING</span></span>
                        and <span style = "font-weight: bold">ISSUE <span style = "color: brown">FRAMING</span></span></a>.
                </p>
                <br>
                <p class="intro__dek">
                    <span style = "font-weight: bold">ISSUE <span style = "color: brown">FILTERING</span></span> implies selective coverage of certain topics.
                    Here, the problem isn't fake news or alternative facts, but 
                    <a href = "https://qz.com/1130094/todays-biggest-threat-to-democracy-isnt-fake-news-its-selective-facts/" target = "_blank">selective facts</a>. 
                    Selective facts are still legitimate facts, but they often times either paint an incomplete picture of a story or leave some 
                    stories out altogether. Issue Filtering tells the audience what to think about. It's curated content, but for facts.
                </p>
                <br>
                <p class="intro__dek">
                    <span style = "font-weight: bold">ISSUE <span style = "color: brown">FRAMING</span></span>, on the other hand, is about how topics are presented.
                    Framing of a story affects the structure of its message and 
                    <a href = "https://masscommtheory.com/theory-overviews/framing-theory/" target = "_blank">specifies its field of meaning</a>. So, while
                    Issue Filtering tells the audience what to think about, Issue Framing tells them how to think about it. 
                </p>
                <br>
                <p class="intro__dek">
                    There is a huge quantity of information disemminated via media every minute, especially during election campaigns. As a result, filtering and framing                
                    may affect the audience's views on various topics and push them towards drawing different conclusions, sometimes divisive ones. Why does this happen? 
                    A possible explanation might be because people prefer to view information that confirms to their pre-existing views and the publishers and platforms 
                    presenting this information to them know who their viewers are. This phenomenon has often been defined as 
                    <a href = "https://en.wikipedia.org/wiki/Confirmation_bias" target = "_blank">confirmation bias</a>.
                </p>
                <br>
                <p class="intro__dek">
                    Below, we visualize the extent of content and coverage bias during the midterm elections of 2018 by examining the cable news headlines for CNN, Fox News 
                    and MSNBC during a three day window of before, during and after the elections. The underlying mechanisms being
                    <span style = "font-weight: bold; color: brown">FILTERING</span> and <span style = "font-weight: bold; color: brown">FRAMING</span>.
                </p>
            </section>
        </div>

        <div id = "word_cloud" class = d_back_white></div>

        <div class = "d_back_white">
            <section id = "scroll" class = "scroll_section">
                <div class="scroll__graphic" id = "f_scatter" style="width: 960px; height: 800px;">  <!-- This is where the visualization goes -->  </div>
                <!-- This is where text goes, as we scroll -->
               <div class="scroll__text">
                    <div class="step is-active" style="height: 615px; position: relative;">
                        <p>Let's begin by mapping out some of the most frequently talked about topics by
                            <span class = "channel">CNN</span>, <span class = "channel">FOX NEWS</span>
                            and <span class = "channel">MSNBC</span> during their midterm elections coverage.
                        </p>
                        <br>
                        <p>
                            Some of the most frequently talked about topics included President <span class = "topic">Trump</span> and
                            his <span class = "topic">rallies</span>, <span class = "topic">migrants</span>, the <span class = "topic">house</span> and the <span class = "topic">senate</span>,
                            with the state of <span class = "topic">Florida</span> and the Democratic candidates Beto <span class = "topic">O'Rourke</span> and
                            Andrew <span class = "topic">Gillum</span>, and Republican candidate Ted <span class = "topic">Cruz</span> getting the most proportional coverage.
                         </p>
                        <br>
                        <p style = "text-decoration: underline; font-size: 18px;">Hover over the topics below to see where they lie in the visualization.</p>
                        <div class = "btns" style="position: absolute; bottom: 0px;">
                            <button id = "trump" class = "d">TRUMP</button>
                            <button id = "senate" class = "d">SENATE</button>
                            <button id = "rallies" class = "d">RALLIES</button>
                            <button id = "orourke" class = "d">O'ROURKE</button>
                            <button id = "migrants" class = "d">MIGRANTS</button>
                            <button id = "gop" class = "d">GOP</button>
                            <button id = "gillum" class = "d">GILLUM</button>
                            <button id = "house" class = "d">HOUSE</button>
                            <button id = "florida" class = "d">FLORIDA</button>
                            <button id = "cruz" class = "d">CRUZ</button>
                        </div>
                    </div>
                    <div class="step" style="height: 615px; position: relative;">
                        <p>Next, let's look at the <span style = "font-weight: bold; text-decoration: underline;">inclusivity</span>
                            of the language used by the three news channels by looking at the number of mentions of under-represented and minority groups.
                        </p>
                        <br>
                        <p>
                            Overall, <span class = "channel">CNN</span> and <span class = "channel">MSNBC</span> frequently mentioned
                            <span class = "topic">women</span>, <span class = "topic">black</span> voters, <span class = "topic">african-american</span> voters, <span class = "topic">hispanics</span>
                            and <span class = "topic">gender</span> (gap and/or bias) with little to no mention of many of these topics by <span class = "channel">FOX NEWS</span>.
                        </p>
                        <div class = "btns" style="position: absolute; bottom: 0px;">
                            <button id = "voters" class = "a">VOTERS</button>
                            <button id = "women" class = "a">WOMEN</button>
                            <button id = "hispanic" class = "a">HISPANIC</button>
                            <button id = "gender" class = "a">GENDER</button>
                            <button id = "female" class = "a">FEMALE</button>
                            <button id = "black" class = "a">BLACK</button>
                            <button id = "african-american" class = "a">AFRICAN-AMERICAN</button>
                        </div>
                    </div>
                    <div class="step" style="height: 615px; position: relative;">
                        <p>Moving on, if we filter out the congressional candidates that generated the most buzz in all three news channels, we can explore some interesting trends.</p>
                        <br>
                        <p>
                            <span class = "channel">CNN</span> and <span class = "channel">MSNBC</span> mentioned Geoegia gubernatotial candidates Brian <span class = "topic">Kemp</span> and Stacey
                            <span class = "topic">Abrams</span> way more often than <span class = "topic">FOX NEWS</span> did. Moreover, <span class = "channel">MSNBC</span> commented
                            on the Arizona senatorial candidates Kristen <span class = "topic">Sinema</span> and Nancy <span class = "topic">McSally</span> more often than 
                            <span class = "channel">CNN</span> or <span class = "topic">FOX NEWS</span> did. Meanwhile, <span class = "channel">CNN</span>'s coverage did not 
                            skew towards any candidate.
                        </p>
                        <div class = "btns" style="position: absolute; bottom: 0px;">
                            <button id = "sinema" class = "b">SINEMA</button>
                            <button id = "orourke" class = "b">O'ROURKE</button>
                            <button id = "nelson" class = "b">NELSON</button>
                            <button id = "mcsally" class = "b">MCSALLY</button>
                            <button id = "mccaskill" class = "b">MCCASKILL</button>
                            <button id = "kemp" class = "b">KEMP</button>
                            <button id = "gillum" class = "b">GILLUM</button>
                            <button id = "desantis" class = "b">DESANTIS</button>
                            <button id = "cruz" class = "b">CRUZ</button>
                            <button id = "crenshaw" class = "b">CRENSHAW</button>
                            <button id = "blackburn" class = "b">BLACKBURN</button>
                            <button id = "abrams" class = "b">ABRAMS</button>
                        </div>
                    </div>
                    <div class="step" style="height: 615px; position: relative;">
                        <p>Lastly, let's also look at some of the most talked about issues during the election. </p>
                        <br>
                        <p><span class = "topic">Immigration</span> and <span class = "topic">economy</span> were some of the most frequently mentioned issues and group
                        relatively proportional coverage from all three channels. Meanwhile, we saw dispropotionately frequent mentions of
                        Brett <span class = "topic">Kavanaugh</span> and <span class = "topic">ICE</span> by <span class = "channel">FOX NEWS</span>,
                        <span class = "topic">Facebook</span>, <span class = "topic">fearmongering</span> and <span class = "topic">approval-rating</span>
                        by <span class = "channel">CNN</span>, and <span class = "topic">abortion</span> and <span class = "topic">impeachment</span> by
                        <span class = "channel">MSNBC</span>.
                        </p>
                        <div class = "btns" style="position: absolute; bottom: 0px;">
                            <button id = "probe" class = "c">PROBE</button>
                            <button id = "media-bias" class = "c">MEDIA-BIAS</button>
                            <button id = "marijuana" class = "c">MARIJUANA</button>
                            <button id = "kavanaugh" class = "c">KAVANAUGH</button>
                            <button id = "impeachment" class = "c">IMPEACHMENT</button>
                            <button id = "immigration" class = "c">IMMIGRATION</button>
                            <button id = "ice" class = "c">ICE</button>
                            <button id = "healthcare" class = "c">HEALTHCARE</button>
                            <button id = "fear" class = "c">FEAR</button>
                            <button id = "facebook" class = "c">FACEBOOK</button>
                            <button id = "economy" class = "c">ECONOMY</button>
                            <button id = "caravan" class = "c">CARAVAN</button>
                            <button id = "border" class = "c">BORDER</button>
                            <button id = "approval-rating" class = "c">APPROVAL-RATING</button>
                            <button id = "abortion" class = "c">ABORTION</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div id = "pivot_scatter">
            <h2 id = 'pivot_intro'>Number of Mentions vs. Total Screen Time</h2>
            <div id = 'pivot_info'>
                <p class="intro__dek">While cable news may mention some topics more or less frequently than others, there is a
                    possibility that the channels spend a significantly more time in talking about a particular headline or topic. So,
                    sometimes the choice of metric can yield different results.
                </p>
                <br>
                <p style = "text-decoration: underline;">Watch the transition in results in action below by using the slider to alter the metrics and pivot the charts for all three channels!</p>
                <br>
                <p style = "font-style: italic; font-size: 0.7em; line-height: 1.0em;">Note: We have excluded some of the most frequently mentioned words like Voters, Trump, Senate and House in order to better fulfil
                the purpose of the visualization.</p>
            </div>
            <div class='graphic graphic--2' style = "width: 50%">
                <p class = 'pivot_label'>MSNBC</p>
                <div class='chart'></div>
                <div class='slider'><input type='range' min='0' max='100' value='50'></div>
            </div>
            <div id = 'pivot_container' style = "height: 420px">
                <div class='graphic graphic--3' style = "width: 50%">
                    <p class = 'pivot_label'>FOX</p>
                    <div class='chart'></div>
                    <div class='slider'><input type='range' min='0' max='100' value='50'></div>
                </div>
            </div>
            <div class='graphic graphic--1' style = "width: 50%">
                <p class = 'pivot_label'>CNN</p>
                <div class='chart'></div>
                <div class='slider'><input type='range' min='0' max='100' value='50'></div>
            </div>
        </div>

        <!-- @Kevin: This is the HTML section for your visualization [Also has associated CSS context] -->
        <div class = "d_back_white" id = 'assoc'>

            <h2 id = 'nn_title'>Which topics were most frequently mentioned together?</h2>
               <div id = "quote">
                <blockquote style = "font-style: italic;">
                    In choosing and displaying news, editors, newsroom staff, and broadcasters play an important part in shaping political
                    reality. Readers learn not only about a given issue, but also how much importance to attach to that issue from the amount
                    of information in a news story and its position. In reflecting what candidates are saying during a campaign, the mass
                    media may well determine the important issues—that is, the media may set the 'agenda' of the campaign.
                    <br>
                    <br>
                    - <a href = "https://academic.oup.com/poq/article-abstract/36/2/176/1853310" target = "_blank">McCombs & Shaw</a>
                </blockquote>
               </div>
            <section id = "scroll_1" class = "scroll_section">
                <div id="noun_to_noun" class="scroll__graphic" style="width: 960px; height: 800px;">  <!-- This is where the visualization goes -->  </div>
                <!-- This is where text goes, as we scroll -->
                <div class="scroll__text">
                    <div class="step is-active" style="height: 615px; position: relative;">
                        <p class = "channel">CNN</p>
                        <p class = "nn_description">
                            When it came to <span class = "topic">voters</span>, <span class = "channel">CNN</span> often talked about
                            them in terms of their <span class = "topic">approval</span> of President <span class = "topic">Trump</span>,
                            voters in states of <span class = "topic">Florida</span> and <span class = "topic">Georgia</span> and in
                            conjunction with <span class = "topic">issues</span> such as  <span class = "topic">immigration</span>
                            and <span class = "topic">healthcare</span>.
                        </p>
                        <br>
                        <p class = "nn_description">
                            However, President Trump himself was associated with issues such as <span class = topic>(anti-)immigration</span>
                            and the <span class = "topic">economy</span>.
                        </p>
                        <br>
                        <p style = "text-decoration: underline; font-size: 18px;">Hover over the topics on the chart or the keywords below!</p>
                        <div class = "btns" style="position: absolute; bottom: 0px;">
                            <button id = "voters" class = "e">VOTERS</button>
                            <button id = "trump" class = "e">TRUMP</button>
                            <button id = "immigration" class = "e">IMMIGRATION</button>
                            <button id = "economy" class = "e">ECONOMY</button>
                        </div>
                    </div>
                    <div class="step" style="height: 615px; position: relative;">
                        <p class = "channel">FOX</p>
                        <p class = "nn_description">
                            <span class = "channel">FOX NEWS</span> frequently mentioned voters in conjunction with President <span class = "topic">Trump</span>,
                            the the <span class = "topic">economy</span>, and while referring to voters from the state of <span class = "topic">Texas</span>.
                        </p>
                        <br>
                        <p class = "nn_description">
                            Meanwhile, President Trump was often mentioned in conjuction with the <span class = "topic">economy</span>, the issue of
                            <span class = "topic">immigration</span> and the mueller-<span class = "topic">investigation</span>.
                        </p>
                        <div class = "btns" style="position: absolute; bottom: 0px;">
                            <button id = "voters" class = "e">VOTERS</button>
                            <button id = "trump" class = "e">TRUMP</button>
                            <button id = "immigration" class = "e">IMMIGRATION</button>
                            <button id = "economy" class = "e">ECONOMY</button>
                        </div>

                    </div>
                    <div class="step" style="height: 615px; position: relative;">
                        <p class = "channel">MSNBC</p>
                        <p class = "nn_description">
                            <span class = "channel">MSNBC</span> compratively focussed on a wider variety of contexts and issues
                            when it came to voters. It not only included President <span class = "topic">Trump</span>, his
                            <span class = "topic">approval-rating</span>, <span class = "topic">immigration</span>,
                            the <span class = "topic">economy</span> and references to voters from <span class = "topic">Florida</span>,
                            <span class = "topic">Geogia</span> and <span class = "topic">Texas</span>, but also referred to their
                            <span class = "topic">enthusiam</span> and other divisive issues such as <span class = "topic">tax</span>
                            and <span class = "topic">abortion</span>.
                        </p>
                        <br>
                        <p class = "nn_description">
                            However, keeping up with the trend, President Trump was mentioned in conjunction with issues mostly pertaining
                            to the <span class = "topic">economy</span> and <span class = "topic">immigration</span>.
                        </p>
                        <div class = "btns" style="position: absolute; bottom: 0px;">
                            <button id = "voters" class = "e">VOTERS</button>
                            <button id = "trump" class = "e">TRUMP</button>
                            <button id = "immigration" class = "e">IMMIGRATION</button>
                            <button id = "economy" class = "e">ECONOMY</button>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <div id = "noun_to_verb">
                <h2 id = 'nv_title'>Which action verbs were often used with some of the dominant topics?</h2>
                <div id = "nv_info">
                    <p class="intro__dek">
                        Action verbs serve as a powerful tool in creating ideas and impressions. By exploring what actions verbs were
                        most frequently associated with the major topics, we can further contextualize how those topics were framed.
                    </p>
                    <br>
                    <p style = "text-decoration: underline;">Click and drag the topics to isolate the verbs by topic!</p>
                </div>
            <div id = "chart_1">
                <p class = 'chart_label'>CNN</p>
            </div>
            <div id = "chart_2">
                <p class = 'chart_label'>FOX</p>
            </div>
            <div id = "chart_3">
                <p class = 'chart_label'>MSNBC</p>
            </div>
        </div>

        <section id="outro"></section>

        <script src="https://d3js.org/d3.v4.min.js"></script> <!-- Note that we're using Scrollama with D3 -->
        <script src="https://unpkg.com/intersection-observer@0.5.0/intersection-observer.js"></script>
        <script src="https://unpkg.com/scrollama"></script>  <!-- We're using Scrollama to get the scrolling functionality -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>
        <script>
            $(document).ready(function(){
                $(this).scrollTop(0);
            });

            d3v4 = d3;

            // using d3

            /** ------------------------------------wordcloud animation-------------------------------- */

            function wordCloud(selector) {

                // var fill = d3v4.scaleOrdinal(d3v4.schemeCategory20);

                var width = $(document).width();
                var height = 500;

                //Construct the word cloud's SVG element
                var svg = d3v4.select(selector).append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", "translate(" + [width >> 1, height >> 1] + ")")


                //Draw the word cloud
                function draw(words) {
                    var cloud = svg.selectAll("g text")
                                    .data(words, function(d) { return d.text; })

                    //Entering words
                    cloud.enter()
                        .append("text")
                        .style("font-family", "Impact")
                        .attr("text-anchor", "middle")
                        .attr('font-size', 1)
                        .text(function(d) { return d.text; });

                    //Entering and existing words
                    cloud
                        .transition()
                            .duration(600)
                            .style("font-size", function(d) { return d.size + "px"; })
                            .attr("transform", function(d) {
                                return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                            })
                            .style("fill-opacity", 1);

                    //Exiting words
                    cloud.exit()
                        .transition()
                            .duration(200)
                            .style('fill-opacity', 1e-6)
                            .attr('font-size', 1)
                            .remove();
                }


                //Use the module pattern to encapsulate the visualisation code. We'll
                // expose only the parts that need to be public.
                return {

                    //Recompute the word cloud for a new set of words. This method will
                    // asycnhronously call draw when the layout has been computed.
                    //The outside world will need to call this function, so make it part
                    // of the wordCloud return value.
                    update: function(words) {
                        d3v4.layout.cloud().size([width, height])
                            .words(words)
                            .padding(5)
                            .rotate(function() { return ~~(Math.random() * 2) * 90; })
                            .font("Impact")
                            .fontSize(function(d) { return d.size; })
                            .on("end", draw)
                            .start();
                    }
                }
            }

            var words = [
                "Voters Women CNN Sessions Fox Democrats States Crime Economy Evidence Races News Candidates Votes Georgia US Elections Power GOP Governor Voting Early President America Pelosi Polls Democratic Rallies Kemp Congress Nationwide Americans Abrams Campaign",
                "Fox Obama Health Midterms Representative Message Missouri CNN Trump Congressional Cruz Senator Ballot Racist House Sanctions Florida White-house Race Issues Win Former Immigration Political Texas Border Majority Stakes Republicans Country Iran Washington",
                "Voters Women CNN Sessions Fox Democrats States Crime Economy Evidence Races News Candidates Votes Georgia US Elections Power GOP Governor Voting Early President America Pelosi Polls Democratic Rallies Kemp Congress Nationwide Americans Abrams Campaign",
                "Fox Obama Health Midterms Representative Message Missouri CNN Trump Congressional Cruz Senator Ballot Racist House Sanctions Florida White-house Race Issues Win Former Immigration Political Texas Border Majority Stakes Republicans Country Iran Washington"
            ]

            //Prepare one of the sample sentences by removing punctuation,
            // creating an array of words and computing a random size attribute.
            function getWords(i) {
                return words[i]
                        .replace(/[!\.,:;\?]/g, '')
                        .split(' ')
                        .map(function(d) {
                            return {text: d, size: 10 + Math.random() * 60};
                        })
            }

            //This method tells the word cloud to redraw with a new set of words.
            //In reality the new words would probably come from a server request,
            // user input or some other source.
            function showNewWords(vis, i) {
                i = i || 0;

                vis.update(getWords(i ++ % words.length))
                setTimeout(function() { showNewWords(vis, i + 1)}, 4000)
            }

            //Create a new instance of the word cloud visualisation.
            var myWordCloud = wordCloud('#word_cloud');

            //Start cycling through the demo data
            myWordCloud.update(getWords(0));
            showNewWords(myWordCloud);

            /** --------------------------wordcloud animation ends------------------------------- */


                // Hope you're doing well so far!


            /** --------------------------frequency scatter plot------------------------------- */

            function scatter_plot(selector) {
                var margin = { top: 50, bottom: 160 }
                var width = 960
                var height = 700 - margin.top - margin.bottom
                var side = height * 2 / Math.sqrt(3)

                var svg = d3v4.select(selector)
                    .append('svg')
                    .attr('width', width)
                    .attr('height', height + margin.top + margin.bottom)
                    .attr('class', 'scroll__graphic')
                    .attr('id', 'scatter_plot')
                    .append('g')
                    .attr('transform', 'translate(' + ((width - side) / 2) + ',' + (margin.top + 0.5) + ')')
                    .append('g')

                var sideScale = d3v4.scaleLinear()
                    .domain([0, 1])
                    .range([0, side])

                var perpScale = d3v4.scaleLinear()
                    .domain([0, 1])
                    .range([height, 0])

                var r = d3v4.scaleSqrt().range([0, 10])

                var axis = d3v4.axisLeft()
                    .scale(perpScale)
                    .tickFormat(function (n) { return (n * 100).toFixed(0) });

                var axes = svg.selectAll('.axis')
                    .data(['Fox', 'CNN', 'MSNBC'])
                    .enter().append('g')
                    .attr('class', function (d) { return 'axis ' + d })
                    .attr('transform', function (d) {
                        return d === 'MSNBC' ? ''
                            : 'rotate(' + (d === 'Fox' ? 240 : 120) + ',' + (side * 0.5) + ',' + (height / 3 * 2) + ')'
                    })
                    .call(axis)

                var tooltip = d3v4.select('body').append("div").attr("class", "toolTip");

                axes.append('path')
                    .attr('class', 'arrow')
                    .attr('d', 'M0 0 L5 9 L2 9 L2 15 L-2 15 L-2 9 L-5 9 Z')
                    .attr('transform', 'translate(' + (side * 0.5) + ',10)')
                    .on('click', rotate)

                axes.append('text')
                    .attr('class', 'label')
                    .attr('x', side * 0.5)
                    .attr('y', -6)
                    .attr('text-anchor', 'middle')
                    .attr('letter-spacing', '-8px')
                    .text(function (d) { return d })
                    .on('click', rotate)

                function rotate(d) {
                    var angle = d === 'fox' ? 120 : d === 'cnn' ? 240 : 0
                    svg.transition().duration(600)
                        .attr('transform', 'rotate(' + angle + ',' + (side / 2) + ',' + (height / 3 * 2) + ')')
                }

                d3v4.csv('t_freq.csv', function (d) {
                    var fox = +d.fox
                    var cnn = +d.cnn
                    var msnbc = +d.msnbc
                    var total = fox + cnn + msnbc
                    var fShare = fox / total
                    var cShare = cnn / total
                    var mShare = msnbc / total

                    return {
                        topic: d.topic,
                        total: total,
                        fox: fox,
                        cnn: cnn,
                        msnbc: msnbc,
                        fShare: fShare,
                        cShare: cShare,
                        mShare: mShare,
                        x: cShare + (mShare * 0.5)
                    }
                }, function (error, data) {
                    if (error) { throw error }

                    r.domain([0, d3v4.max(data, function (d) { return d.total })])

                    svg.selectAll('.point')
                        .data(data)
                        .enter().append('circle')
                        .attr('class', 'point')
                        .attr('id', function(d) {return (d.topic + "_point")})
                        .attr('r', 5)
                        .attr('cx', width / 10 )
                        .attr('cy', height / 2 )
                        .transition()
                        .duration(300)
                        .delay(function (d) { return r(d.total) })
                        .attr('cx', function (d) { return sideScale(d.x) })
                        .attr('cy', function (d) { return perpScale(d.mShare) })
                        .transition()
                        .duration(100)
                        .attr('r', function (d) { return r(d.total) * 4 });

                    svg.selectAll('.point')
                        .on("mousemove", function(d){
                            tooltip
                            .style("left", d3v4.event.pageX - 50 + "px")
                            .style("top", d3v4.event.pageY - 70 + "px")
                            .style("display", "inline-block")
                            .html((d.topic));
                        })
    		        .on("mouseout", function(d){
                            tooltip.style("display", "none");
                        });
                })
            }

            function scatter_plot_update(index) {
                if (index == 0) {
                    d3v4.select("#scatter_plot").remove();
                    scatter_plot('#f_scatter');

                    var plot = d3.select('#scatter_plot');

                    d3v4.selectAll(".d")
                        .on("mouseover", function() {
                            var point = d3v4.select("#" + this.id + "_point");
                            plot.selectAll('.point')
                                .style('opacity', 0.05);
                            point.style('opacity', 1).style('fill', 'black');
                        })
                        .on("mouseout", function(d){
                            plot.selectAll('.point').style('opacity', 1).style('fill', '#30303d');
                        });
                }
                else if (index == 1) {
                    var plot = d3v4.select('#scatter_plot');

                    d3v4.selectAll(".d").on("mouseover", function() {
                        // do nothing
                    })
                    .on("mouseout", function(d){
                            // do nothing
                    });

                    plot.selectAll('.point')
                        .transition()
                        .style('opacity', 0.05);

                    var selection = plot.selectAll('#women_point, #african-american_point, #black_point, #hispanic_point, #voters_point, #female_point,#gender_point');

                    selection.transition()
                        .style('opacity', 1)
                        .style('fill', 'black');

                    d3v4.selectAll(".a")
                        .on("mouseover", function() {
                            var point = d3v4.select("#" + this.id + "_point");
                            selection.style('opacity', 0.05);
                            point.style('opacity', 1).style('fill', 'black');
                        })
                        .on("mouseout", function(){
                            selection.style('opacity', 1).style('fill', 'black');
                        });
                }
                else if (index == 2) {
                    d3v4.selectAll(".a").on("mouseover", function() {
                        // do nothing
                    })
                    .on("mouseout", function(d){
                            // do nothing
                    });

                    var plot = d3v4.select('#scatter_plot');
                    plot.selectAll('.point')
                        .transition()
                        .style('opacity', 0.1);

                    var selection = plot.selectAll('#gillum_point, #abrams_point, #blackburn_point, #crenshaw_point, #desantis_point, #cruz_point, #kemp_point, #mccaskill_point, #mcsally_point, #sinema_point, #nelson_point, #orourke_point');
                    selection.transition()
                        .style('opacity', 1)
                        .style('fill', 'black');

                    d3v4.selectAll(".b")
                        .on("mouseover", function() {
                            var point = d3v4.select("#" + this.id + "_point");
                            selection.style('opacity', 0.05);
                            point.style('opacity', 1).style('fill', 'black');
                        })
                        .on("mouseout", function(){
                            selection.style('opacity', 1).style('fill', 'black');
                        });
                }
                else {
                    d3v4.selectAll(".b").on("mouseover", function() {
                        // do nothing
                    })
                    .on("mouseout", function(d){
                            // do nothing
                    });

                    var plot = d3v4.select('#scatter_plot');
                    plot.selectAll('.point')
                        .transition()
                        .style('opacity', 0.1);

                    var selection = plot.selectAll('#abortion_point, #approval-rating_point, #media-bias_point, #border_point, #caravan_point, #facebook_point, #fear_point, #healthcare_point, #ice_point, #immigration_point, #marijuana_point, #impeachment_point, #probe_point, #kavanaugh_point, #economy_point');
                    selection.transition()
                        .style('opacity', 1)
                        .style('fill', 'black');

                    d3v4.selectAll(".c")
                        .on("mouseover", function() {
                            var point = d3v4.select("#" + this.id + "_point");
                            selection.style('opacity', 0.05);
                            point.style('opacity', 1).style('fill', 'black');
                        })
                        .on("mouseout", function(d){
                            selection.style('opacity', 1).style('fill', 'black');
                        });
                }
            }

            /** --------------------------frequency scatter plot ends------------------------------- */

                // This was hard, okay.

            /** --------------------------duration + frequency scatter plot------------------------------- */

            function pivot_scatter(selector, dummyData) {
                const graphic = d3v4.select(selector)

                const COLORS = ['#ff3814', '#fe5c34', '#fc764f', '#f88d69', '#f2a385', '#e8b8a0', '#dbcdbd']
                const FONT_SIZE = 11
                const MAX_VAL = 10

                const chart = scatterplot();
                const el = graphic.select('.chart');

                function weightData({ x, y }) {
                    return dummyData.map(d => ({
                        ...d,
                        score: d.x * x + d.y * y,
                    }))
                    .sort((a, b) => d3v4.descending(a.score, b.score))
                    .map((d, i) => ({
                        ...d,
                        rank: i,
                    }))
                    .reverse()
                }

                function getHypotenuse({ x, y }) {
                    const x2 = x * x
                    const y2 = y * y
                    return Math.sqrt(x2 + y2)
                }

                function resize() {
                    const sz = Math.min(el.node().offsetWidth, window.innerHeight) * 0.8
                    chart.width(sz).height(sz)
                    el.call(chart)
                }

                function scatterplot() {
                    const margin = FONT_SIZE * 3
                    const scaleX = d3v4.scaleLinear()
                    const scaleY = d3v4.scaleLinear()
                    const scaleR = d3v4.scaleSqrt()
                    const scaleC = d3v4.scaleQuantile()

                    let width = 0
                    let height = 0
                    let chartWidth = 0
                    let chartHeight = 0
                    let weightX = 50
                    let weightY = 50
                    let hypotenuse = 0

                    function translate(x, y) {
                        return `translate(${x}, ${y})`
                    }

                    function enter({ container, data }) {
                        const svg = container.selectAll('svg').data([data])
                        const svgEnter = svg.enter().append('svg')
                        const gEnter = svgEnter.append('g')

                        gEnter.append('g').attr('class', 'g-plot')

                        const axis = gEnter.append('g').attr('class', 'g-axis')

                        const x = axis.append('g').attr('class', 'axis axis--x')

                        const y = axis.append('g').attr('class', 'axis axis--y')

                        x.append('text').attr('class', 'axis__label')
                            .attr('text-anchor', 'start')
                            .text('Mentions')

                        y.append('text').attr('class', 'axis__label')
                            .attr('text-anchor', 'end')
                            .text('Screentime')
                    }

                    function exit({ container, data }) {
                    }

                    function updateScales({ data }) {
                        hypotenuse = getHypotenuse({ x: weightX, y: weightY })
                        const rangeX = weightX / hypotenuse * chartWidth
                        const rangeY = weightY / hypotenuse * chartHeight
                        const maxR = Math.floor(FONT_SIZE * 1.5)

                        scaleX
                            .domain([0, MAX_VAL])
                            .range([0, rangeX])

                        scaleY
                            .domain([0, MAX_VAL])
                            .range([rangeY, 0])

                        scaleR
                            .domain([0, data.length])
                            .range([maxR, 2])

                        scaleC
                            .domain(data.map(d => d.rank))
                            .range(COLORS)
                    }

                    function updateDom({ container, data }) {
                        const svg = container.select('svg')

                        svg
                            .attr('width', width)
                            .attr('height', height)

                        const g = svg.select('g')

                        const maxY = scaleY.range()[0]
                        const offsetX = chartWidth / 2
                        const offsetY = chartHeight - maxY
                        const rad = Math.acos(weightX / hypotenuse)
                        const angle = 90 - (rad * 180 / Math.PI)
                        const rotation = `rotate(${-angle} 0 ${scaleY.range()[0]})`
                        const translation = translate(margin * 1.5 + offsetX, margin + offsetY)
                        const transform = `${translation} ${rotation}`
                        g.attr('transform', transform)

                        const plot = g.select('.g-plot')

                        const item = plot.selectAll('.item').data(d => d, d => d.index)

                        item.enter().append('circle')
                            .attr('class', 'item')
                        .merge(item)
                            .attr('x', 0)
                            .attr('y', 0)
                            .attr('r', d => scaleR(d.rank))
                            .style('fill', d => {
                                if (d.channel === "msnbc" && (d.topic  === "kemp" || d.topic  === "abrams")) return "#000000";
                                if (d.channel === "fox" && d.topic  === "congress") return "#000000";
                                // if (d.channel === "msnbc" && d.topic  === "kemp") return "#000000";
                                return scaleC(d.rank)})
                            .style('stroke', d => d3v4.color(scaleC(d.rank)).darker(0.7))
                            .style('opacity', 0.7)
                            .attr('transform',  d => translate(scaleX(d.x), scaleY(d.y)))

                        $(selector + ' .toolTip').remove();
                        var tooltip = d3v4.select(selector).append("div").attr("class", "toolTip");

                        plot.selectAll('.item')
                            .on("mousemove", function(d){
                                tooltip
                                .style("left", d3v4.event.pageX - 50 + "px")
                                .style("top", d3v4.event.pageY - 70 + "px")
                                .style("display", "inline-block")
                                .html((d.topic));
                            })
                            .on("mouseout", function(d){
                                tooltip.style("display", "none");
                            });
                    }

                    function updateAxis({ container, data }) {
                        const axis = container.select('.g-axis')

                        const axisLeft = d3v4.axisLeft(scaleY)
                        const axisBottom = d3v4.axisBottom(scaleX)

                        axisLeft.ticks(Math.max(0, Math.floor(weightY / 10)))
                        axisBottom.ticks(Math.max(0, Math.floor(weightX / 10)))
                        const x = axis.select('.axis--x')

                        const maxY = scaleY.range()[0]
                        const offset = maxY

                        const buffer = Math.ceil(margin / 2)
                        x.attr('transform', translate(0, buffer + offset))
                            .call(axisBottom)

                        const y = axis.select('.axis--y')

                        y.attr('transform', translate(-buffer, 0))
                            .call(axisLeft)

                        x.select('.axis__label')
                            .attr('y', margin - 1)

                        y.select('.axis__label')
                            .attr('x', offset)
                            .attr('y', margin - 1)
                            .attr('transform', `rotate(90)`)
                    }

                    function chart(container) {
                        const data = container.datum()

                        enter({ container, data })
                        exit({ container, data })
                        updateScales({ container, data })
                        updateDom({ container, data })
                        updateAxis({ container, data })
                    }

                    chart.width = function(...args) {
                        if (!args.length) return width
                        width = args[0]
                        chartWidth = width - margin * 2.5
                        return chart
                    }

                    chart.height = function(...args) {
                        if (!args.length) return height
                        height = args[0]
                        chartHeight = height - margin * 2.5
                        return chart
                    }

                    chart.weight = function({ x, y }) {
                        weightX = x
                        weightY = y
                        return chart
                    }

                    return chart
                }

                function handleInput(sliderInput) {
                    let val = sliderInput.value;
                    let x = val;
                    let y = 100 - val;
                    let weighted = weightData({x, y});

                    chart.weight({x, y});
                    el.datum(weighted);
                    el.call(chart);
                }

                function init() {
                    el.datum(weightData({x: 50, y: 50}));
                    el.call(chart);
                    resize();
                    window.addEventListener('resize', resize);

                    let sliderInput = $(selector + ' .slider input')[0];
                    let min = sliderInput.min;
                    let max = sliderInput.max;

                    let interval;
                    function play() {
                        function next() {
                            let val = parseInt(sliderInput.value);
                            sliderInput.value = (val + 1) > max ? min : (val + 1);
                            handleInput(sliderInput);
                        }
                        clearInterval(interval);
                        interval = setInterval(next, 60);
                    }


                    function manualOverride() {
                        clearInterval(interval);
                        handleInput(sliderInput)
                        interval = setTimeout(play, 2500);  // delay when user manually select slider
                    }

                    sliderInput.oninput = manualOverride;
                    play();

                }

                init()
            }

            var data_fox;
            var data_cnn;
            var data_msnbc;

            d3v4.csv('td_fox.csv', function(data) {
                data_fox = data.map(function(d) {
                    return {
                        channel: "fox",
                        topic: d.topic,
                        x: (d.duration * 10) / 1118,
                        y: (d.frequency * 10) / 65,
                        index: d.index
                    }
                })
                pivot_scatter(".graphic--3", data_fox);
            })

            d3v4.csv('td_cnn.csv', function(data) {
                data_cnn = data.map(function(d) {
                    return {
                        channel: "cnn",
                        topic: d.topic,
                        x: (d.duration * 10) / 4268,
                        y: (d.frequency * 10) / 156,
                        index: d.index
                    }
                })
                pivot_scatter(".graphic--1", data_cnn);
            })

            d3v4.csv('td_msnbc.csv', function(data) {
                data_msnbc = data.map(function(d) {
                    return {
                        channel: "msnbc",
                        topic: d.topic,
                        x: (d.duration * 10) / 3403,
                        y: (d.frequency * 10) / 230,
                        index: d.index
                    }
                })
                pivot_scatter(".graphic--2", data_msnbc);
            })

            /** --------------------------duration + frequency scatter plot ends--------------------------- */

                // Kevin's turn now

            /** --------------------------noun to noun plot----------------------------------------------- */

            var cnnNn2dArr, allCnnNnWords, foxNn2dArr, allFoxNnWords, msnbcNn2dArr, allMsnbcNnWords;

            function noun_to_noun(selector, data, allWords) {

                // // temporary data for experiment
                // data = [
                //   [1, 2, 3, 4],
                //   [5, 6, 7, 8],
                //   [9, 10, 11, 12],
                //   [13, 14, 15, 16]
                // ];

                var height = $(document).height() * 0.079;
                var width = $(document).width() * 0.5;

                var outerRadius = width * 0.3; //Math.min(width, height) * 0.3;
                var innerRadius = outerRadius * 0.95;
                // var outmostRadius = outerRadius * 1.1;

                // set up the arc between label and outer path boundary
                var arc = d3v4.arc()
                            .innerRadius(innerRadius)
                            .outerRadius(outerRadius);

                // var outmostArc = d3.arc()
                //                    .innerRadius(innerRadius)
                //                    .outerRadius(outmostRadius);

                // function for passing in data
                var chord = d3v4.chord()
                              .padAngle(0.05)
                              .sortSubgroups(d3v4.descending);

                // the path main svg element
                var svg = d3v4.select(selector)
                            .append("svg")
                            .attr("id", "n_to_n")
                            .attr("width", width)
                            .attr("height", height)
                            .attr("transform", "translate(0, 15)")
                            .append("g")
                            .attr("id", "circle")
                            .attr("width", width)
                            .attr("height", height)
                            .attr("transform", "translate(" + width / 2 + "," + (outerRadius + 100) + ")");

                svg.append("circle").attr("r", outerRadius);

                // the paths
                var ribbon = d3v4.ribbon()
                               .radius(innerRadius);

                // color elements
                var color = d3v4.scaleOrdinal()
                              .domain(d3v4.range(data.length))
                              .range(["#BBBBBB", "#BBBBBB", "#BBBBBB", "#BBBBBB"]);

                // pass the matrix in for processing
                var chords = chord(data);

                // seperates each group for its own "g" element (for mouseover)
                var group = svg.selectAll("g")
                               .data(chords.groups)
                               .enter().append("g")
                               // adds the class for identifying each arc & text
                               .attr("class", (d, i) => {return "group nn_mouse_over nn_mouse_over_" + allWords[i] + " nn_mouse_over nn_mouse_over_" + allWords[i] + "_1";})
                               .on("mouseover", nnMouseOver)
                               .on("mouseout", nnMouseOut);

                // // creates the marks
                // var groupTick = group.selectAll("g")
                //                      .data(d => calculateMiddle(d))
                //                      .enter().append("g")
                //                      .attr("transform", d => `rotate(${d.angle * 180 / Math.PI - 90}) translate(${outerRadius},0)`);

                // // creates a white outer arc
                // group.append("path")
                //      .attr("d", outmostArc)
                //      .attr("fill", "#FFFFFF")
                //      ;

                // // creates the labels
                // groupTick.filter(d => d.value === 0)
                //          .append("text")
                //          .attr("x", 8)
                //          .attr("dy", ".35em")
                //          .attr("transform", d => d.angle > Math.PI ? "rotate(180) translate(-16)" : null)
                //          .attr("text-anchor", d => d.angle > Math.PI ? "end" : null)
                //          .text(function(d,i) { console.log(i); return allWords[i]; });

                // creates the labels
                var labels = group.append("text")
                                  .each(function(d) { d.angle = ((d.startAngle + d.endAngle) / 2);})
                                  .attr("dy", ".35em")
                                  .attr("class", "titles")
                                  .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
                                  .attr("transform", function(d,i) {
                                      var c = arc.centroid(d);
                                      return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                                      + "translate(" + (outerRadius + 9) + ")"
                                      + (d.angle > Math.PI ? "rotate(180)" : "")
                                  })

                                  // .attr("transform", d => {
                                  //     var angle = d.angle * 180 / Math.PI - 90;
                                  //     return `rotate(${angle > Math.PI? angle + 180 : angle}) translate(${outerRadius},0)`
                                  // })
                                  .text(function(d,i) { return allWords[i].charAt(0).toUpperCase() + allWords[i].substr(1); });

                // creates the paths
                var edges = svg.append("g")
                               .attr("fill-opacity", 0.67)
                               .selectAll("path")
                               .data(chords)
                               .enter().append("path")
                               .attr("d", ribbon)
                               .attr("fill", d => color(d.target.index))
                               .attr("stroke", d => d3v4.rgb(color(d.target.index)).darker())
                               .attr("class", d => "nn_mouse_over nn_mouse_over_" + allWords[d.source.index] + " nn_mouse_over_" + allWords[d.target.index]);
                               //.attr("transform", "translate(" + width / 2 + "," + (outerRadius + 100 ) + ")");

                // for each pair of edges, add class attribute to text and arc
                edges.each((d, i) => {
                  svg.selectAll(".group.nn_mouse_over_" + allWords[d.source.index] + "_1").classed("nn_mouse_over_" + allWords[d.target.index], true);
                  svg.selectAll(".group.nn_mouse_over_" + allWords[d.target.index] + "_1").classed("nn_mouse_over_" + allWords[d.source.index], true);
                })

                // creates the arc on the edge besides the text
                var groupChord = group.append("path")
                                      .attr("d", arc)
                                      .attr("fill", "#888888");
                                      //.on("mouseover", chordMouseOver);

                // set the mouseover and mouseout of buttons at the bottom of descriptions
                d3v4.selectAll(".e")
                    .on("mouseover", function() {
                        svg.selectAll(".nn_mouse_over").attr("visibility", "hidden");
                        svg.selectAll(".nn_mouse_over_" + this.id).attr("visibility", "visible");
                        svg.selectAll(".nn_mouse_over_" + this.id + "_1").classed("nn_mouse_over_current", true);
                        svg.selectAll(".nn_mouse_over_" + this.id + "_1").select("path").attr("fill", "brown");
                    })
                    .on("mouseout", function() {
                        svg.selectAll(".nn_mouse_over").attr("visibility", "visible").classed("nn_mouse_over_current", false);
                        svg.selectAll(".nn_mouse_over_" + this.id + "_1").select("path").attr("fill", "#888888");
                    });

                function calculateMiddle(d) {
                  const k = (d.endAngle + d.startAngle) / 2;
                  return d3v4.range(0, d.value).map(value => {
                    return {value: value, angle: k};
                  });
                }

                function nnMouseOver(d, i) {
                    // edges.classed("fade", function(p) {
                    //     return p.source.index != i && p.target.index != i;
                    // })
                    svg.selectAll(".nn_mouse_over").attr("visibility", "hidden");
                    svg.selectAll(".nn_mouse_over_" + allWords[i]).attr("visibility", "visible");
                    svg.selectAll(".nn_mouse_over_" + allWords[i] + "_1").classed("nn_mouse_over_current", true);
                    svg.selectAll(".nn_mouse_over_" + allWords[i] + "_1").select("path").attr("fill", "brown");
                }

                function nnMouseOut(d, i) {
                    svg.selectAll(".nn_mouse_over").attr("visibility", "visible").classed("nn_mouse_over_current", false);
                    svg.selectAll(".nn_mouse_over_" + allWords[i] + "_1").select("path").attr("fill", "#888888");
                }

            }

            // the function renders the graph based on the current step
            function noun_to_noun_step(index) {
                d3v4.selectAll("#n_to_n").remove();

                if (index == 4) {
                    noun_to_noun("#noun_to_noun", cnnNn2dArr, allCnnNnWords);
                } else if (index == 5) {
                    noun_to_noun("#noun_to_noun", foxNn2dArr, allFoxNnWords);
                } else if (index == 6) {
                    noun_to_noun("#noun_to_noun", msnbcNn2dArr, allMsnbcNnWords);
                }
            }

            // the initial function that loads all the data from files and stores them in cache
            function loadNnData() {
                d3v4.text("cnn_nn(clean).txt", function(text) {

                    // original file, each arr element being a single line
                    var cnnNnArr = text.split("\n");

                    // remove the empty lines at the end
                    removeEmptyLines(cnnNnArr);

                    // the list contains all the words
                    allCnnNnWords = getListOfAllWords(cnnNnArr);

                    // the 2d array (empty right now)
                    cnnNn2dArr = generateEmpry2dArray(allCnnNnWords);

                    // add in the data to the 2d array
                    fillIn2dArray(cnnNn2dArr, allCnnNnWords, cnnNnArr);

                });

                d3v4.text("fox_nn(clean).txt", function(text) {

                    // original file, each arr element being a single line
                    var foxNnArr = text.split("\n");

                    // remove the empty lines at the end
                    removeEmptyLines(foxNnArr);

                    // the list contains all the words
                    allFoxNnWords = getListOfAllWords(foxNnArr);

                    // the 2d array (empty right now)
                    foxNn2dArr = generateEmpry2dArray(allFoxNnWords);

                    // add in the data to the 2d array
                    fillIn2dArray(foxNn2dArr, allFoxNnWords, foxNnArr);

                });

                d3v4.text("msbnc_nn(clean).txt", function(text) {

                    // original file, each arr element being a single line
                    var msnbcNnArr = text.split("\n");

                    // remove the empty lines at the end
                    removeEmptyLines(msnbcNnArr);

                    // the list contains all the words
                    allMsnbcNnWords = getListOfAllWords(msnbcNnArr);

                    // the 2d array (empty right now)
                    msnbcNn2dArr = generateEmpry2dArray(allMsnbcNnWords);

                    // add in the data to the 2d array
                    fillIn2dArray(msnbcNn2dArr, allMsnbcNnWords, msnbcNnArr);

                });
            }

            // removes the empty lines at the end of the file
            function removeEmptyLines(arr) {
                for (var i = arr.length - 1; i >= 0; i--) {
                    if (arr[i].trim() == "") {
                        arr.pop();
                    }
                }
            }

            // returns a list that contains all the unique words in the file with alphabetical order
            function getListOfAllWords(arr) {
                var listOfAllWords = [];
                for (var i = 0; i < arr.length; i++) {
                    var lineArr = arr[i].split(",");
                    for (var j = 0; j < lineArr.length; j++) {
                        lineArr[j] = lineArr[j].trim();
                        if (lineArr[j].length == 0) {
                            break;
                        }
                        var wordArr = lineArr[j].split(":");
                        if (listOfAllWords.indexOf(wordArr[0]) == -1) {
                            listOfAllWords.push(wordArr[0]);
                        }
                    }
                }
                return listOfAllWords.sort();
            }

            // generates an empty 2d array with all 0's based on the length of allWords
            function generateEmpry2dArray(allWords) {
                var empty2dArr = [];
                for (var i = 0; i < allWords.length; i++) {
                    var tempArr = [];
                    for (var j = 0; j < allWords.length; j++) {
                        tempArr.push(0);
                    }
                    empty2dArr.push(tempArr);
                }
                return empty2dArr;
            }

            // fills in the 2d Array
            // @param arr the 2d array
            // @param allWords the array with all the unique words
            // @param rawDataArr the raw data array, with each array element being the string of each entire line
            function fillIn2dArray(arr, allWords, rawDataArr) {
                for (var i = 0; i < rawDataArr.length; i++) {
                    var singleLineRawDataArr = rawDataArr[i].split(",");
                    for (var j = 1; j < singleLineRawDataArr.length; j++) {
                        singleLineRawDataArr[j] = singleLineRawDataArr[j].trim();
                        if (singleLineRawDataArr[j].length == 0) {
                            break;
                        }
                        var singleWordArr = singleLineRawDataArr[j].split(":");
                        arr[allWords.indexOf(singleLineRawDataArr[0])][allWords.indexOf(singleWordArr[0])] = parseInt(singleWordArr[1]);
                        arr[allWords.indexOf(singleWordArr[0])][allWords.indexOf(singleLineRawDataArr[0])] = parseInt(singleWordArr[1]);
                    }
                }
            }

            /** --------------------------noun to noun plot ends------------------------------------------- */

                // More graphs!

            /** --------------------------noun to verb plot----------------------------------------------- */

            /** --------------------------noun to verb plot ends------------------------------------------- */

                // We're almost there

            /** --------------------------scrollama implementation---------------------------------------- */

            function scrolly() {
                var container = d3v4.select('#scroll');
                var graphic = container.select('.scroll__graphic');
                var text = container.select('.scroll__text');
                var step = text.selectAll('.step');

                // initialize the scrollama
                var scroller = scrollama();

                // generic window resize listener event
                function handleResize() {
                    // 1. update height of step elements
                    var stepHeight = Math.floor(window.innerHeight * 0.75);
                    step.style('height', stepHeight + 'px');

                    // 2. update width/height of graphic element
                    var bodyWidth = d3v4.select('body').node().offsetWidth;

                    var graphicMargin = 16 * 4;
                    var textWidth = text.node().offsetWidth;
                    var graphicWidth = container.node().offsetWidth - textWidth - graphicMargin;
                    var graphicHeight = Math.floor(4 * window.innerHeight / 5)
                    var graphicMarginTop = Math.floor(graphicHeight / 2)

                    graphic
                        .style('width', graphicWidth + 'px')
                        .style('height', graphicHeight + 'px')


                    // 3. tell scrollama to update new element dimensions
                    scroller.resize();
                }

                // scrollama event handlers
                function handleStepEnter(response) {
                    // response = { element, direction, index }

                    // add color to current step only
                    step.classed('is-active', function (d, i) {
                        return i === response.index;
                    })

                    // update graphic based on step
                    scatter_plot_update(response.index);
                }

                function handleContainerEnter(response) {
                    // response = { direction }

                    // old school
                    // sticky the graphic
                    graphic.classed('is-fixed', true);
                    graphic.classed('is-bottom', false);
                }

                function handleContainerExit(response) {
                    // response = { direction }

                    // old school
                    // un-sticky the graphic, and pin to top/bottom of container
                    graphic.classed('is-fixed', false);
                    graphic.classed('is-bottom', response.direction === 'down');
                }

                function init() {
                    // 1. force a resize on load to ensure proper dimensions are sent to scrollama
                    handleResize();

                    // 2. setup the scroller passing options
                    // this will also initialize trigger observations
                    // 3. bind scrollama event handlers (this can be chained like below)
                    scroller.setup({
                        container: '#scroll',
                        graphic: '.scroll__graphic',
                        text: '.scroll__text',
                        step: '.scroll__text .step',
                        debug: false,  // if you turn this on, then you'll be able to visualize the step triggers (Try it!)
                        offset: 0.5,
                    })
                        .onStepEnter(handleStepEnter)
                        .onContainerEnter(handleContainerEnter)
                        .onContainerExit(handleContainerExit);

                    // setup resize event
                    window.addEventListener('resize', handleResize);
                }

                // kick things off
                init();
            }

            scrolly();

            // @Kevin: Your second scrolly section
            function scrolly_1() {
                var container = d3v4.select('#scroll_1');
                var graphic = container.select('.scroll__graphic');
                var text = container.select('.scroll__text');
                var step = text.selectAll('.step');

                // initialize the scrollama
                var scroller_1 = scrollama();

                // generic window resize listener event
                function handleResize() {
                    // 1. update height of step elements
                    var stepHeight = Math.floor(window.innerHeight * 0.75);
                    step.style('height', stepHeight + 'px');

                    // 2. update width/height of graphic element
                    var bodyWidth = d3v4 .select('body').node().offsetWidth;

                    var graphicMargin = 16 * 4;
                    var textWidth = text.node().offsetWidth;
                    var graphicWidth = container.node().offsetWidth - textWidth - graphicMargin;
                    var graphicHeight = Math.floor(4.5 * window.innerHeight / 5)
                    var graphicMarginTop = Math.floor(graphicHeight / 2)

                    graphic
                        .style('width', graphicWidth + 'px')
                        .style('height', graphicHeight + 'px')


                    // 3. tell scrollama to update new element dimensions
                    scroller_1.resize();
                }

                // scrollama event handlers
                function handleStepEnter(response) {
                    // response = { element, direction, index }

                    // add color to current step only
                    step.classed('is-active', function (d, i) {
                        return (i + 4) === response.index;
                    })

                    // @Kevin: Here's where your update function should go
                    // update graphic based on step

                    noun_to_noun_step(response.index);
                }

                function handleContainerEnter(response) {
                    // response = { direction }

                    // old school
                    // sticky the graphic
                    graphic.classed('is-fixed', true);
                    graphic.classed('is-bottom', false);
                }

                function handleContainerExit(response) {
                    // response = { direction }

                    // old school
                    // un-sticky the graphic, and pin to top/bottom of container
                    graphic.classed('is-fixed', false);
                    graphic.classed('is-bottom', response.direction === 'down');
                }

                function init() {

                    loadNnData();

                    // 1. force a resize on load to ensure proper dimensions are sent to scrollama
                    handleResize();

                    // 2. setup the scroller passing options
                    // this will also initialize trigger observations
                    // 3. bind scrollama event handlers (this can be chained like below)
                    scroller_1.setup({
                        container: '#scroll_1',
                        graphic: '.scroll__graphic',
                        text: '.scroll__text',
                        step: '.scroll__text .step',
                        debug: false,  // if you turn this on, then you'll be able to visualize the step triggers (Try it!)
                        offset: 0.5,
                    })
                        .onStepEnter(handleStepEnter)
                        .onContainerEnter(handleContainerEnter)
                        .onContainerExit(handleContainerExit);

                    // setup resize event
                    window.addEventListener('resize', handleResize);
                }

                // kick things off
                init();
            }

            // @Kevin: kicking off your scrolly
            scrolly_1();

            /** --------------------------scrollama implementation ends------------------------------- */
        </script>

        <script type="text/javascript" src="https://d3js.org/d3.v3.min.js"></script>
        <script type="text/javascript" src="https://www.google.com/jsapi"></script>
        <script type="text/javascript">
            google.load("jquery", "1");

            d3v3 = d3;

            function noun_to_verb(selector, data_url, h) {
                google.setOnLoadCallback(function() {
                    initialize().then (
                        function (control) {
                            doTheTreeViz(control);
                        }
                    );
                });
                function doTheTreeViz(control) {
                    var svg = control.svg;

                    var force = control.force;
                    force.nodes(control.nodes)
                        .links(control.links)
                        .start();

                    // Update the links
                    var link = svg.selectAll("line.link")
                        .data(control.links, function(d) {
                            return d.key;
                        } );

                    // Enter any new links
                    var linkEnter = link.enter().insert("svg:line", ".node")
                        .attr("class", "link")
                        .attr("x1", function(d) { return d.source.x; })
                        .attr("y1", function(d) { return d.source.y; })
                        .attr("x2", function(d) { return d.target.x; })
                        .attr("y2", function(d) { return d.target.y; })
                    .append("svg:title")
                        .text(function(d) { return d.target.name + ":" + d.source.name ; });

                    // Exit any old links.
                    link.exit().remove();


                    // Update the nodes
                    var node = svg.selectAll("g.node")
                        .data(control.nodes, function(d) { return d.key; });

                    node.select("circle")
                        .style("fill", function(d) {
                            return getColor(d);
                        })
                        .attr("r", function(d) {
                            return getRadius(d);
                        })

                    // Enter any new nodes.
                    var nodeEnter = node.enter()
                    .append("svg:g")
                        .attr("class", "node")
                        .attr("transform", function(d) { return "translate(" + d.x + "," + d.y+ ")"; })
                        .on("dblclick", function(d){
                            control.nodeClickInProgress=false;
                            if (d.url)window.open(d.url);
                        })
                        .on("click", function(d){
                            // this is a hack so that click doesnt fire on the1st click of a dblclick
                            if (!control.nodeClickInProgress ) {
                                control.nodeClickInProgress = true;
                                setTimeout(function(){
                                    if (control.nodeClickInProgress) {
                                        control.nodeClickInProgress = false;
                                        if (control.options.nodeFocus) {
                                            d.isCurrentlyFocused = !d.isCurrentlyFocused;
                                            doTheTreeViz(makeFilteredData(control));
                                        }
                                    }
                                },control.clickHack);
                            }
                        })
                        .call(force.drag);

                    nodeEnter
                    .append("svg:circle")
                        .attr("r", function(d) {
                            return getRadius(d);
                        })
                        .style("fill", function(d) {
                            return getColor(d);
                        })
                        .on("mouseover", function(d){
                            // enhance all the links that end here
                            enhanceNode (d);
                        })

                        .on("mouseout", function(d){
                            resetNode(d);

                        })
                    .append("svg:title")
                        .text(function(d) { return d[control.options.nodeLabel]; })

                    function enhanceNode(selectedNode) {
                        link.filter ( function (d) {
                            return d.source.key == selectedNode.key || d.target.key == selectedNode.key;
                        } )
                        .style("stroke", control.options.routeFocusStroke)
                        .style("stroke-width", control.options.routeFocusStrokeWidth);

                        if (text) {
                            text.filter ( function (d) {
                                return areWeConnected (selectedNode,d);
                            } )
                            .style("fill", control.options.routeFocusStroke);
                        }
                    }

                    function areWeConnected (node1,node2) {
                        for (var i=0; i < control.data.links.length ; i++) {
                            var lnk = control.data.links[i];
                            if ( (lnk.source.key === node1.key && lnk.target.key === node2.key) ||
                                (lnk.source.key === node2.key && lnk.target.key === node1.key) ) return lnk;
                        }
                        return null;
                    }
                    function resetNode(selectedNode) {
                        link.style("stroke", control.options.routeStroke)
                            .style("stroke-width", control.options.routeStrokeWidth);
                        if (text) {
                            text.style("fill", control.options.routeStroke);
                        }
                    }

                    if (control.options.nodeLabel) {
                    // text is done once for shadow as well as for text
                        var textShadow = nodeEnter.append("svg:text")
                            .attr("x", function(d) {
                                var x = (d.right || !d.fixed) ?
                                    control.options.labelOffset :
                                    (-d.dim.width - control.options.labelOffset)  ;
                                return x;
                            })
                            .attr("dy", ".31em")
                            .attr("class", "shadow")
                            .attr("text-anchor", function(d) {
                                return !d.right ? 'start' : 'start' ;
                            })
                            .style("font-size",control.options.labelFontSize + "px")
                            .text(function(d) {
                                return d.shortName ? d.shortName : d.name;
                            });

                        var text = nodeEnter.append("svg:text")
                            .attr("x", function(d) {
                                var x = (d.right || !d.fixed) ?
                                    control.options.labelOffset :
                                    (-d.dim.width - control.options.labelOffset)  ;
                                return x;
                            })
                            .attr("dy", ".35em")
                            .attr("class", "text")
                            .attr("text-anchor", function(d) {
                                return !d.right ? 'start' : 'start' ;})
                            .style("font-size",control.options.labelFontSize + "px")
                            .text(function(d) {
                                return d.shortName ? d.shortName : d.name;
                            })

                            .on("mouseover", function(d){
                            // enhance all the links that end here
                                enhanceNode (d);
                                d3v3.select(this)
                                    .style('fill',control.options.routeFocusStroke);
                            })

                            .on("mouseout", function(d){
                                resetNode(d);
                            });
                    }

                    // Exit any old nodes.
                    node.exit().remove();
                    control.link = svg.selectAll("line.link");
                    control.node = svg.selectAll("g.node");
                    force.on("tick", tick);



                    if (control.options.linkName) {
                        link.append("title")
                            .text(function(d) {
                                return d[control.options.linkName];
                        });
                    }


                    function tick() {
                        link.attr("x1", function(d) { return d.source.x; })
                            .attr("y1", function(d) { return d.source.y; })
                            .attr("x2", function(d) { return d.target.x; })
                            .attr("y2", function(d) { return d.target.y; });
                        node.attr("transform", function(d) {
                            return "translate(" + d.x + "," + d.y + ")";
                        });

                    }

                    function getRadius(d) {
                        return makeRadius(control,d);
                    }
                    function getColor(d) {
                        return control.options.nodeFocus && d.isCurrentlyFocused ? control.options.nodeFocusColor  : '#fe5c34' ;
                    }
5
                    }

                    function makeRadius(control,d) {
                    var r = control.options.radius * (control.options.nodeResize ? Math.sqrt(d[control.options.nodeResize]) / Math.PI : 1);
                    return control.options.nodeFocus && d.isCurrentlyFocused ? control.options.nodeFocusRadius  : r;
                    }

                    function makeFilteredData(control,selectedNode){
                    // we'll keep only the data where filterned nodes are the source or target
                    var newNodes = [];
                    var newLinks = [];

                    for (var i = 0; i < control.data.links.length ; i++) {
                        var link = control.data.links[i];
                        if (link.target.isCurrentlyFocused || link.source.isCurrentlyFocused) {
                            newLinks.push(link);
                            addNodeIfNotThere(link.source,newNodes);
                            addNodeIfNotThere(link.target,newNodes);
                        }
                    }
                    // if none are selected reinstate the whole dataset
                    if (newNodes.length > 0) {
                        control.links = newLinks;
                        control.nodes = newNodes;
                    }
                    else {
                        control.nodes = control.data.nodes;
                        control.links = control.data.links;
                    }
                    return control;

                    function addNodeIfNotThere( node, nodes) {
                        for ( var i=0; i < nodes.length; i++) {
                            if (nodes[i].key == node.key) return i;
                        }
                        return nodes.push(node) -1;
                    }
                    }

                    function getPixelDims(scratch,t) {
                    // scratch is an elemen with the correct styling, t is the text to be counted in pixels
                    scratch.empty();
                    scratch.append(document.createTextNode(t));
                    return { width: scratch.outerWidth(), height: scratch.outerHeight() } ;
                    }
                    function initialize () {

                    var initPromise = $.Deferred();
                    var control = {};
                    control.divName = selector;

                    //some basic options
                    var newoptions = {  nodeLabel:"label",
                                    nodeResize:"count", height: h,
                                    nodeFocus:true, radius:3, charge:-100};
                    // defaults
                    control.options = $.extend({
                            stackHeight : 12,
                            radius : 5,
                            fontSize : 14,
                            labelFontSize : 15,
                            labelLineSpacing: 2.5,
                            nodeLabel : null,
                            markerWidth : 0,
                            markerHeight : 0,
                            width : $(control.divName).outerWidth() - 300,
                            gap : 1.5,
                            nodeResize : "",
                            linkDistance : 80,
                            charge :  120,
                            styleColumn : null,
                            styles : null,
                            linkName : null,
                            nodeFocus: true,
                            nodeFocusRadius: 25,
                            nodeFocusColor: "Brown",
                            labelOffset: 5,
                            gravity: .05,
                            routeFocusStroke: "Brown",
                            routeFocusStrokeWidth: 3,
                            circleFill: "Black",
                            routeStroke: "Black",
                            routeStrokeWidth: 1,
                            height : $(control.divName).outerHeight()

                        }, newoptions);

                    var options = control.options;
                    options.gap = options.gap * options.radius;
                    control.width = options.width;
                    control.height = options.height;
                    // this is an element that can be used to determine the width of a text label

                    control.scratch = $(document.createElement('span'))
                        .addClass('shadow')
                        .css('display','none')
                        .css("font-size",control.options.labelFontSize + "px");
                    $('body').append(control.scratch);

                    getTheData(control).then( function (data) {

                        control.data = data;
                        control.nodes = data.nodes;
                        control.links = data.links;
                        control.clickHack = 200;

                        control.svg = d3v3.select(control.divName)
                            .append("svg:svg")
                            .attr("width", control.width)
                            .attr("height", control.height);

                        control.force = d3v3.layout.force().
                            size([control.width, control.height])
                            .linkDistance(control.options.linkDistance)
                            .charge(control.options.charge)
                            .gravity(control.options.gravity);

                    initPromise.resolve(control);
                    });
                    return initPromise.promise();
                    }

                    function getTheData(control) {
                    var dataPromise = getTheRawData();
                    var massage = $.Deferred();
                    dataPromise.done ( function (data) {
                        // need to massage it
                        massage.resolve ( dataMassage (control,data));
                    })
                    .fail (function (error) {
                        console.log (error);
                        massage.reject(error);
                    });
                    return massage.promise();
                    }

                    function dataMassage(control,data) {

                    var ind = data, nodes = [],links =[];
                    // the tags are to be circles
                    for (var i=0;i<ind.length;i++) {
                        ind[i].isCurrentlyFocused = false;
                        nodes.push(ind[i]);
                    // add links to pages
                    for ( var j=0; j < ind[i].pages.length; j++) {
                        //push this page as a node
                        var node = findOrAddPage(control,ind[i].pages[j],nodes);
                        node.isCurrentlyFocused = false;
                        // create a link
                        var link = { source:node , target:ind[i], key : node.key + "_" + ind[i].key };
                        links.push(link);
                    }
                    }
                    // sort nodes alpha
                    nodes.sort ( function (a,b) { return a.name < b.name  ? -1 : (a.name == b.name ? 0 : 1 ) ; });
                    control.pageCount = 0;
                    control.pageRectSize = {width:0,height:0,radius:0};
                    for ( var i = 0; i < nodes.length ; i++) {
                    page= nodes[i];
                    page.group =0;
                    page.dim = getPixelDims(control.scratch, page.name);
                    if (page.fixed) {
                        control.pageCount++;
                        // this will calculate the width/height in pixels of the largest label
                        control.pageRectSize.width = Math.max(control.pageRectSize.width,page.dim.width);
                        control.pageRectSize.height = Math.max(control.pageRectSize.height,page.dim.height);
                        control.pageRectSize.radius = Math.max(control.pageRectSize.radius,makeRadius(control,page));
                        page.group =1;
                    }

                    }
                    var options= control.options;

                    // we're going to fix the nodes that are pages into two columns
                    for ( var i = 0, c=0; i < nodes.length ; i++) {
                        var page = nodes[i];
                        if (page.fixed) {
                            page.right= (c > control.pageCount/2);
                            // y dimension calc same for each column
                            page.y = ((c % (control.pageCount/2)) + .5) * (control.pageRectSize.height)  ;

                            // x based on right or left column
                            page.x = page.right ?
                                        control.width - control.pageRectSize.width - options.labelOffset  :
                                        page.dim.width + options.labelOffset ;
                            c++;
                        }

                    }

                    return {  nodes: nodes, links: links };

                    }

                    function findOrAddPage(control,page,nodes) {
                    for ( var i=0;i<nodes.length;i++) {
                        if ( nodes[i].key === page.key ) {
                            nodes[i].count++;
                            return nodes[i];
                        }
                    }
                    page.fixed = true;
                    page.count = 0;
                    return nodes[nodes.push(page) - 1] ;
                    }


                    // modify with your proxy and dataurl
                    // take the raw data and prepare it for d3
                    function getParameterByName(name) {
                    name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
                    var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                        results = regex.exec(location.search);
                    return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
                    }
                    // modify with your proxy and dataurl
                    // take the raw data and prepare it for d3
                    function getTheRawData() {
                    // here's a php proxy to make jsonP
                    var proxyUrl="https://script.google.com/macros/s/AKfycbzMhwJy-OAR28YTBxO1AbVdSQQFI101X3UDzY-1yc9lUgBfpSc/exec";;

                    var dataUrl = getParameterByName('data') || data_url;

                    // promise will be resolved when done
                    return getPromiseData(dataUrl,proxyUrl);
                    }

                    // no need to touch this
                    // general deferred handler for getting json data through proxy and creating promise
                    function getPromiseData(url,proxyUrl){
                    var deferred = $.Deferred();
                    var u = proxyUrl+"?url="+encodeURIComponent(url);

                    $.getJSON(u, null,
                        function (data) {
                            if (Math.floor(data.responseCode/100 ) !== 2) {
                            throw 'error ' + data.responseCode + ' getting data ' + data.result;
                            }
                            // data returned by apps script proxy is encoded json.
                            deferred.resolve(JSON.parse(data.result));
                    })
                    .error(function(res, status, err) {
                        deferred.reject("error " + err + " for " + url);
                    });

                    return deferred.promise();
                    }
            }
            noun_to_verb("#chart_1", "https://raw.githubusercontent.com/cse442-18f/fp-divided-congress-and-coverage/master/docs/cnn.json?token=AkZWGrX3FTNAQuWlJRpdVcOdD18_wdyMks5cDD9ewA%3D%3D", 400);
            noun_to_verb("#chart_2", "https://raw.githubusercontent.com/cse442-18f/fp-divided-congress-and-coverage/master/docs/fox.json?token=AkZWGiS-pM9DlJDGsERS8kQ5uiX5aSHLks5cDD90wA%3D%3D", 400);
            noun_to_verb("#chart_3", "https://raw.githubusercontent.com/cse442-18f/fp-divided-congress-and-coverage/master/docs/msnbc.json?token=AkZWGgYKq5zhTn3Ls8OypfZvhgzc9Sryks5cDD-NwA%3D%3D", 450);
        </script>
    </body>
</html>
